<!DOCTYPE html>
<html lang="zh-cn">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="anfieldqi">
  
  
  
  
  
  <link rel="canonical" href="https://anfieldqi.github.io/post/python/flask%E6%A1%86%E6%9E%B6/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           Flask框架学习 | AnfieldQi`s Blog
       
  </title>
  <meta name="title" content="Flask框架学习 | AnfieldQi`s Blog">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/anfieldqi.github.io"
    },
    "articleSection" : "post",
    "name" : "Flask框架学习",
    "headline" : "Flask框架学习",
    "description" : "Flask框架 1.安装flask 安装flask框架并在项目中导入 2.基本文件结构 static:存放静态资源，图片，js,css等 templa",
    "inLanguage" : "zh-cn",
    "author" : "anfieldqi",
    "creator" : "anfieldqi",
    "publisher": "anfieldqi",
    "accountablePerson" : "anfieldqi",
    "copyrightHolder" : "anfieldqi",
    "copyrightYear" : "2020",
    "datePublished": "2020-04-11 16:28:09 \x2b0800 CST",
    "dateModified" : "2020-04-11 16:28:09 \x2b0800 CST",
    "url" : "https:\/\/anfieldqi.github.io\/post\/python\/flask%E6%A1%86%E6%9E%B6\/",
    "wordCount" : "2658",
    "keywords" : [  "AnfieldQi`s Blog"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://anfieldqi.github.io">AnfieldQi`s Blog</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/post/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://anfieldqi.github.io">AnfieldQi`s Blog</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/post/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Flask框架学习</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://anfieldqi.github.io" rel="author">anfieldqi</a> with ♥ 
                <span class="post-time">
                on <time datetime=2020-04-11 itemprop="datePublished">April 11, 2020</time>
                </span>
                in
                
        </div>
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          <h3 id="flask框架">Flask框架</h3>
<h4 id="1安装flask">1.安装flask</h4>
<blockquote>
<p>安装flask框架并在项目中导入</p>
</blockquote>
<h4 id="2基本文件结构">2.基本文件结构</h4>
<blockquote>
<p>static:存放静态资源，图片，js,css等
templates:存放模板文件
server.py：网站的逻辑</p>
</blockquote>
<h4 id="3获取url参数">3.获取URL参数</h4>
<blockquote>
<p>列出所有URL参数:request.args.<strong>str</strong>()
查看传给flask的数据：request.full_path request.path</p>
</blockquote>
<h5 id="31-获取某个指定的参数">3.1 获取某个指定的参数</h5>
<blockquote>
<p>浏览器：http://127.0.0.1:5000/?info=hello
后端：request.args.get(&lsquo;info&rsquo;)
flask不允许返回None</p>
</blockquote>
<h5 id="32处理多值">3.2处理多值</h5>
<blockquote>
<p>使用request.args.getlist(&lsquo;p&rsquo;)</p>
</blockquote>
<h4 id="4获取post方法传送的数据">4.获取POST方法传送的数据</h4>
<p>服务端：</p>
<pre><code>
from flask import Flask, request

app = Flask(__name__)


@app.route('/')def hello_world():
    return 'hello world'


@app.route('/register', methods=['POST'])def register():
    print(request.headers)
    print(request.stream.read())
    return 'welcome'


if __name__ == '__main__':
    app.run(port=5000, debug=True)
    
</code></pre><p>客户端：</p>
<pre><code>
import requests

user_info = {'name': 'letian', 'password': '123'}
r = requests.post(&quot;http://127.0.0.1:5000/register&quot;, data=user_info)

print(r.text)
</code></pre><blockquote>
<p>解析post数据：request.form</p>
</blockquote>
<pre><code>
from flask import Flask, request

app = Flask(__name__)

@app.route('/')def hello_world():
    return 'hello world'


@app.route('/register', methods=['POST'])def register():
    print(request.headers)
    # print(request.stream.read()) # 不要用，否则下面的form取不到数据
    print(request.form)
    print(request.form['name'])
    print(request.form.get('name'))
    print(request.form.getlist('name'))
    print(request.form.get('nickname', default='little apple')) #可以设默认值
    return 'welcome'


if __name__ == '__main__':
    app.run(port=5000, debug=True)
</code></pre><h4 id="5处理和响应json数据">5.处理和响应JSON数据</h4>
<blockquote>
<p>使用 HTTP POST 方法传到网站服务器的数据格式可以有很多种，比如name=letian&amp;password=123这种用过&amp;符号分割的key-value键值对格式。也可以用JSON格式、XML格式。相比XML的重量、规范繁琐，JSON显得非常小巧和易用</p>
</blockquote>
<blockquote>
<p>处理json格式的请求数据：request.json</p>
</blockquote>
<p><strong>响应json-方法1：response</strong></p>
<pre><code>
from flask import Flask, request, Response
import json

app = Flask(&quot;my-app&quot;)


@app.route('/')
def hello_world():
    return 'Hello World!'


@app.route('/add', methods=['POST'])
def add():
    result = {'sum': request.json['a'] + request.json['b']}
    return Response(json.dumps(result),  mimetype='application/json')#响应头设置为json
    resp.headers.add('Server', 'python flask'）#为相应头添加东西

if __name__ == '__main__':
    app.run(host='127.0.0.1', port=5000, debug=True)
</code></pre><p><strong>响应json-方法2：使用jsonify</strong></p>
<pre><code>
from flask import Flask, request, jsonify

app = Flask(&quot;my-app&quot;)


@app.route('/')
def hello_world():
    return 'Hello World!'


@app.route('/add', methods=['POST'])
def add():
    result = {'sum': request.json['a'] + request.json['b']}
    return jsonify(result)


if __name__ == '__main__':
    app.run(host='127.0.0.1', port=5000, debug=True)
</code></pre><h4 id="6上传文件">6.上传文件</h4>
<blockquote>
<p>假设将上传的图片只允许&rsquo;png&rsquo;、&lsquo;jpg&rsquo;、&lsquo;jpeg&rsquo;、&lsquo;gif'这四种格式，通过url/upload使用POST上传，上传的图片存放在服务器端的static/uploads目录下。</p>
</blockquote>
<blockquote>
<p>werkzeug库可以判断文件名是否安全，例如防止文件名是../../../a.png，安装这个库：</p>
</blockquote>
<p>服务端：</p>
<pre><code>
from flask import Flask, request

from werkzeug.utils import secure_filename
import os

app = Flask(__name__)

# 文件上传目录
app.config['UPLOAD_FOLDER'] = 'static/uploads/'# 支持的文件格式
app.config['ALLOWED_EXTENSIONS'] = {'png', 'jpg', 'jpeg', 'gif'}  # 集合类型


# 判断文件名是否是我们支持的格式def allowed_file(filename):
    return '.' in filename and \
           filename.rsplit('.', 1)[1] in app.config['ALLOWED_EXTENSIONS']


@app.route('/')def hello_world():
    return 'hello world'


@app.route('/upload', methods=['POST'])def upload():
    upload_file = request.files['image']
    if upload_file and allowed_file(upload_file.filename):
        filename = secure_filename(upload_file.filename)
        # 将文件保存到 static/uploads 目录，文件名同上传时使用的文件名
        upload_file.save(os.path.join(app.root_path, app.config['UPLOAD_FOLDER'], filename))
        return 'info is '+request.form.get('info', '')+'. success'
    else:
        return 'failed'


if __name__ == '__main__':
    app.run(port=5000, debug=True)
</code></pre><p>客户端：</p>
<pre><code>
import requests

file_data = {'image': open('Lenna.jpg', 'rb')}

user_info = {'info': 'Lenna'}

r = requests.post(&quot;http://127.0.0.1:5000/upload&quot;, data=user_info, files=file_data)

print(r.text)
</code></pre><p>运行client.py，当前目录下的Lenna.jpg将上传到服务器。然后，我们可以在static/uploads中看到文件Lenna.jpg。要控制上产文件的大小，可以设置请求实体的大小，例如：</p>
<p>app.config[&lsquo;MAX_CONTENT_LENGTH&rsquo;] = 16 * 1024 * 1024 #16MB</p>
<h4 id="7restful-url">7.Restful URL</h4>
<blockquote>
<p>Restful URL可以看做是对 URL 参数的替代</p>
</blockquote>
<pre><code>
@app.route('/user/&lt;username&gt;')def user(username):
    print(username)
    print(type(username))
    return 'hello ' + username


@app.route('/user/&lt;username&gt;/friends')def user_friends(username):
    print(username)
    print(type(username))
    return 'hello ' + username
</code></pre><blockquote>
<p>访问http://127.0.0.1:5000/user/letian 
输出：</p>
</blockquote>
<pre><code>letian
&lt;class 'str'&gt;
</code></pre><h5 id="71-转换类型">7.1 转换类型</h5>
<blockquote>
<p>使用 Restful URL 得到的变量默认为str对象。如果我们需要通过分页显示查询结果，那么需要在url中有数字来指定页数。用flask内置的转换机制，即在route中指定该如何转换。</p>
</blockquote>
<pre><code>@app.route('/page/&lt;int:num&gt;')def page(num):
    print(num)
    print(type(num))
    return 'hello world'
</code></pre><pre><code>
@app.route('/page/&lt;int:num1&gt;-&lt;int:num2&gt;')
def page(num1, num2):
    print(num1)
    print(num2)
    return 'hello world'
</code></pre><p>注意这里只有三张类型可以转换：</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>int</td>
<td>accepts integers</td>
</tr>
<tr>
<td>float</td>
<td>like int but for floating point values</td>
</tr>
<tr>
<td>path</td>
<td>like the default but also accepts slashes</td>
</tr>
</tbody>
</table>
<h5 id="72-编写转换器">7.2 编写转换器</h5>
<blockquote>
<p>继承自：werkzeug.routing.BaseConverter
修改：to_python和to_url
to_python方法用于将url中的变量转换后供被@app.route包装的函数使用，
to_url方法用于flask.url_for中的参数转换。</p>
</blockquote>
<pre><code>app.url_map.converters['my_int'] = MyIntConverter
</code></pre><h4 id="8使用url_for生成连接">8.使用url_for生成连接</h4>
<blockquote>
<p>url_for可以生成url软连接</p>
</blockquote>
<pre><code>
from flask import Flask, url_for

app = Flask(__name__)

@app.route('/')def hello_world():
    pass

@app.route('/user/&lt;name&gt;')def user(name):
    pass

@app.route('/page/&lt;int:num&gt;')def page(num):
    pass

@app.route('/test')def test():
    print(url_for('hello_world'))
    print(url_for('user', name='letian'))
    print(url_for('page', num=1, q='hadoop mapreduce 10%3'))
    print(url_for('static', filename='uploads/01.jpg'))
    return 'Hello'

if __name__ == '__main__':
    app.run(debug=True)
</code></pre><h4 id="9使用redirect重定向网址">9.使用redirect重定向网址</h4>
<pre><code>
from flask import Flask, url_for, redirect

app = Flask(__name__)

@app.route('/')def hello_world():
    return 'hello world'

@app.route('/test1')def test1():
    print('this is test1')
    return redirect(url_for('test2'))

@app.route('/test2')def test2():
    print('this is test2')
    return 'this is test2'

if __name__ == '__main__':
    app.run(debug=True)
</code></pre><h4 id="10使用jinja2模板引擎">10.使用jinja2模板引擎</h4>
<blockquote>
<p>给模板传递变量render_template(&lsquo;user_info.html&rsquo;, page_title='letian's info&rsquo;, user_info=user_info)</p>
</blockquote>
<h4 id="11自定义404">11.自定义404</h4>
<blockquote>
<p>要处理HTTP错误，可以使用flask.abort函数。</p>
</blockquote>
<pre><code>
from flask import Flask, render_template_string, abort

app = Flask(__name__)


@app.route('/')def hello_world():
    return 'hello world'


@app.route('/user')def user():
    abort(401)  # Unauthorized 未授权
    print('Unauthorized, 请先登录')


if __name__ == '__main__':
    app.run(port=5000, debug=True)
    
</code></pre><p><strong>自定义错误页面</strong></p>
<blockquote>
<p>render_template_string(&lsquo;<!-- raw HTML omitted --> Unauthorized <!-- raw HTML omitted --><!-- raw HTML omitted -->{{ error_info }}<!-- raw HTML omitted -->&rsquo;</p>
</blockquote>
<pre><code>
from flask import Flask, render_template_string, abort

app = Flask(__name__)


@app.route('/')def hello_world():
    return 'hello world'


@app.route('/user')def user():
    abort(401)  # Unauthorized


@app.errorhandler(401)def page_unauthorized(error):
    return render_template_string('&lt;h1&gt; Unauthorized &lt;/h1&gt;&lt;h2&gt;{{ error_info }}&lt;/h2&gt;', error_info=error), 401


if __name__ == '__main__':
    app.run(port=5000, debug=True)
</code></pre><h4 id="12用户会话">12.用户会话</h4>
<blockquote>
<p>session用来记录用户的登录状态，一般基于cookie实现。</p>
</blockquote>
<pre><code>
from flask import Flask, render_template_string, \
    session, request, redirect, url_for

app = Flask(__name__)

app.secret_key = 'F12Zr47j\3yX R~X@H!jLwf/T'


@app.route('/')def hello_world():
    return 'hello world'


@app.route('/login')def login():
    page = '''
    &lt;form action=&quot;{{ url_for('do_login') }}&quot; method=&quot;post&quot;&gt;
        &lt;p&gt;name: &lt;input type=&quot;text&quot; name=&quot;user_name&quot; /&gt;&lt;/p&gt;
        &lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt;
    &lt;/form&gt;
    '''
    return render_template_string(page)


@app.route('/do_login', methods=['POST'])def do_login():
    name = request.form.get('user_name')
    session['user_name'] = name
    return 'success'


@app.route('/show')def show():
    return session['user_name']


@app.route('/logout')def logout():
    session.pop('user_name', None)
    return redirect(url_for('login'))


if __name__ == '__main__':
    app.run(port=5000, debug=True)
    
</code></pre><blockquote>
<p>1.app.secret_key用于给session加密
2.在/login中将向用户展示一个表单，要求输入一个名字，submit后将数据以post的方式传递给/do_login
3./do_login将名字存放在session中
4.如果用户成功登录，访问/show时会显示用户的名字。此时，打开firebug等调试工具，选择session面板，会看到有一个cookie的名称为session
5./logout用于登出，通过将session中的user_name字段pop即可。Flask中的session基于字典类型实现，调用pop方法时会返回pop的键对应的值；如果要pop的键并不存在，那么返回值是pop()的第二个参数。另外，使用redirect()重定向时，一定要在前面加上return</p>
</blockquote>
<h6 id="设置sessin的有效时间">设置sessin的有效时间</h6>
<pre><code>
from datetime import timedelta
from flask import session, app

session.permanent = True
app.permanent_session_lifetime = timedelta(minutes=5)
</code></pre><h4 id="13使用闪存系统">13.使用闪存系统</h4>
<blockquote>
<p>Flask的闪存系统（flashing system）用于向用户提供反馈信息，这些反馈信息一般是对用户上一次操作的反馈。反馈信息是存储在服务器端的，当服务器向客户端返回反馈信息后，这些反馈信息会被服务器端删除。</p>
</blockquote>
<pre><code>
from flask import Flask, flash, get_flashed_messages
import time

app = Flask(__name__)
app.secret_key = 'some_secret'


@app.route('/')def index():
    return 'hi'


@app.route('/gen')def gen():
    info = 'access at '+ time.time().__str__()
    flash(info)
    return info


@app.route('/show1')def show1():
    return get_flashed_messages().__str__()


@app.route('/show2')def show2():
    return get_flashed_messages().__str__()


if __name__ == &quot;__main__&quot;:
    app.run(port=5000, debug=True)
</code></pre><blockquote>
<p>访问http://127.0.0.1:5000/gen 显示:access at 1404020982.83
查看cookie:
查看show1：可以看到连接记录</p>
</blockquote>
<p><strong>对flash分类</strong></p>
<pre><code>
from flask import Flask, flash, get_flashed_messages
import time

app = Flask(__name__)
app.secret_key = 'some_secret'


@app.route('/')def index():
    return 'hi'


@app.route('/gen')def gen():
    info = 'access at '+ time.time().__str__()
    flash('show1 '+info, category='show1')
    flash('show2 '+info, category='show2')
    return info


@app.route('/show1')def show1():
    return get_flashed_messages(category_filter='show1').__str__()

@app.route('/show2')def show2():
    return get_flashed_messages(category_filter='show2').__str__()


if __name__ == &quot;__main__&quot;:
    app.run(port=5000, debug=True)
</code></pre>
    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>anfieldqi </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://anfieldqi.github.io/post/python/flask%E6%A1%86%E6%9E%B6/>https://anfieldqi.github.io/post/python/flask%E6%A1%86%E6%9E%B6/</span>
            </p>
            
             
            <p class="copyright-item lincese">
                除特别标注，文章采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
            </p>
            
    </div>

  
    <div class="post-tags">
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="https://anfieldqi.github.io">home</a></span>
        </section>
    </div>

    <div class="post-nav">
         
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2019 - 2020</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://anfieldqi.github.io">anfieldqi</a> | </span> 
         

         
		  <span>备案号 <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  



     </div>
  </body>
</html>

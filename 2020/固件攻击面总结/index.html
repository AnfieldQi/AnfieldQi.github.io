<!DOCTYPE html>
<html lang="zh-cn">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="anfieldqi">
  
  
  
  <link rel="prev" href="http://anfieldqi.top/2020/discovering_and_understanding_the_security_hazards_in_the_interactions/" />
  <link rel="next" href="http://anfieldqi.top/2020/avatar1/" />
  <link rel="canonical" href="http://anfieldqi.top/2020/%E5%9B%BA%E4%BB%B6%E6%94%BB%E5%87%BB%E9%9D%A2%E6%80%BB%E7%BB%93/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           固件供给面总结 | AnfieldQi`s Blog
       
  </title>
  <meta name="title" content="固件供给面总结 | AnfieldQi`s Blog">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "http:\/\/anfieldqi.top"
    },
    "articleSection" : "posts",
    "name" : "固件供给面总结",
    "headline" : "固件供给面总结",
    "description" : "固件攻击面总结 攻击面 设备WEB界面 设备固件 本地数据存储 更新机制 移动应用程序 网络流量 认证与授权 隐私泄露 1.设备Web界面 这里主要是针对固件的w",
    "inLanguage" : "zh-cn",
    "author" : "anfieldqi",
    "creator" : "anfieldqi",
    "publisher": "anfieldqi",
    "accountablePerson" : "anfieldqi",
    "copyrightHolder" : "anfieldqi",
    "copyrightYear" : "2020",
    "datePublished": "2020-09-01 19:30:29 \x2b0800 CST",
    "dateModified" : "2020-09-01 19:30:29 \x2b0800 CST",
    "url" : "http:\/\/anfieldqi.top\/2020\/%E5%9B%BA%E4%BB%B6%E6%94%BB%E5%87%BB%E9%9D%A2%E6%80%BB%E7%BB%93\/",
    "wordCount" : "3161",
    "keywords" : [ "iot", "AnfieldQi`s Blog"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    
    <div class="top-scroll-bar"></div>
    
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="http://anfieldqi.top">AnfieldQi`s Blog</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
    
        <div class="top-scroll-bar"></div>
    
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="http://anfieldqi.top">AnfieldQi`s Blog</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">固件供给面总结</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="http://anfieldqi.top" rel="author">anfieldqi</a> with ♥ 
                <span class="post-time">
                on <time datetime=2020-09-01 itemprop="datePublished">September 1, 2020</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="http://anfieldqi.top/categories/iot%E5%AE%89%E5%85%A8/"> IoT安全 </a>
                        
                </span>
                <span class="post-word-count">, 3161 words</span>
        </div>
    </header>
    <div class="post-content">
        

        
            
        

        
        
     
          
          
          

          
          
          

          <h2 id="固件攻击面总结">固件攻击面总结</h2>
<table>
<thead>
<tr>
<th>攻击面</th>
</tr>
</thead>
<tbody>
<tr>
<td>设备WEB界面</td>
</tr>
<tr>
<td>设备固件</td>
</tr>
<tr>
<td>本地数据存储</td>
</tr>
<tr>
<td>更新机制</td>
</tr>
<tr>
<td>移动应用程序</td>
</tr>
<tr>
<td>网络流量</td>
</tr>
<tr>
<td>认证与授权</td>
</tr>
<tr>
<td>隐私泄露</td>
</tr>
</tbody>
</table>
<h4 id="1设备web界面">1.设备Web界面</h4>
<p>这里主要是针对固件的web页面，包括一些固件的自有界面和管理界面等，这里可以使用web测试的方法论给出固件测试的方法。</p>
<p><img src="../../../../static/images/owasp_web.jpg" alt="owasp_web"></p>
<h5 id="第一步信息收集">第一步：信息收集</h5>
<p>通过 OSINT 收集信息，收集子域名，收集应用程序入口，识别 web 服务器，识别应用程序框架，总之就是收集尽可能多的信息。信息收集看似简单，实际上非常关键。</p>
<ol>
<li>
<p>探测 Web 服务器指纹：常见 Web 服务器有 Apache2，nginx，IIS 等，尽量探测出服务器及对应版本**（工具http://whatweb.bugscaner.com/look/或者上的工具）**</p>
</li>
<li>
<p>枚举 Web 服务器上的应用：可能是 ssh，rtsp 等非 Web 应用，也可能是非标准端口（非 80，443）的 Web 应用，也可能是同一域名，不同路径下的不同应用**（工具：nmap扫描端口）**</p>
</li>
<li>
<p>识别应用入口：比如找到一个 8443 端口，但是访问这个端口显示空白页面，可能需要访问 ip:8443/entry 才会有数据展示</p>
</li>
<li>
<p>了解站点结构：掌握站点的结构，找到一些执行路径，这些都是可以测试的点**（工具：御剑，Dirmap）**</p>
</li>
</ol>
<h5 id="第二步配置和部署管理测试">第二步：配置和部署管理测试</h5>
<p>web环境一般涉及到操作系统，web服务器，开发框架等，一般在进行web测试之前会根据收集的信息进行测试。比如用的什么操作系统有没有打好补丁。对于web系统的测试，一般这部分被分为白盒，这个部分我们暂时不进行测试。本部分强调的是 Web 服务器本身的配置测试，不同的服务器比如 apache，IIS 可能有不同的安全加固点，一些基本思路，比如只使能必要的模块，自定义错误页面，最低权限允许服务器软件，合理记录日志等</p>
<p>可以尝试测试的点：</p>
<ol>
<li>
<p>尝试上一步分析出来的路径，试试路径爆破和文件上传存不存在问题，以及可不可以意外获取到其存在一些目录下的旧文件和备份文件。</p>
</li>
<li>
<p>枚举http方法，<strong>使用OPTIONS</strong></p>
</li>
<li>
<p>强制执行https：<strong>检测服务器返回信息中 http header 是否有 Strict-Transport-Security 字段</strong></p>
</li>
<li>
<p>HTTP绕过验证：防止私有信息泄露或越权访问</p>
</li>
<li>
<p>执行HTTP降级攻击： 重点是降低两个节点之间的通信通道中使用的加密级别。 降低安全通道中使用的加密级别可能会导致设备发送信息时根本不进行任何加密，就像HTTP一样。 此测试强制使用SSLStrip，Ettercap，Better-cap等将通信从HTTPS降级为HTTP。如果成功降级了对话，则第三方可能会收集凭据和控制数据包等关键信息。 <strong>如果设备拒绝降级并拒绝任何非HTTPS连接，则将其视为安全设备。</strong></p>
</li>
</ol>
<h5 id="第三步身份鉴别管理测试">第三步：身份鉴别管理测试</h5>
<ol>
<li>
<p>测试注册流程，看看固件的web界面是否有类似普通用户，管理员账户的分别</p>
</li>
<li>
<p>检测是否存在<strong>guest账户</strong>，看看这些账户有什么权限（多见于家用路由器）</p>
</li>
<li>
<p>账户的暂停与恢复：有些站点的注册机制等是和应用界面是分开的，这样的话需要单独对每个入口进行测试</p>
</li>
</ol>
<h5 id="第四步认证测试">第四步：认证测试</h5>
<ol>
<li>认证的方式：是否使用https,如果使用的http，无论是BASIC还是DIGEST.都是不安全的，前者是明文的，后者也形同虚设，这个归类为<strong>协议的不安全性</strong>，我们之前测试的固件都存在这个问题</li>
<li>系统有没有默认的凭证：比如admin/admin root/root</li>
<li>检测认证绕过:这里就有很多可能，比如 <strong>sql 注入绕过，修复返回值绕过</strong>等</li>
<li>检测密码更改和重置功能:需要通过查看请求内容以及逆向代码审计等简单看一下业务逻辑</li>
</ol>
<p>需要掌握的内容：常见的有 PAP，CHAP，Digest 等认证机制</p>
<h5 id="第五步授权测试">第五步：授权测试</h5>
<ol>
<li>测试目录遍历/文件包含是否存在问题</li>
<li>绕过授权机制：测试一下授权的逻辑是怎样的，多见于面向客户的固件，工控的就一个管理界面倒是没什么问题。<strong>（例子：看一下cookie里有没有看起来与授权相关的字段）</strong></li>
<li>测试越权：分别对垂直越权和水平越权的相关内容进行测试，<strong>（这里有一篇介绍自动检测架构的文章https://www.secrss.com/articles/13426）</strong></li>
<li>测试有没有不安全的对象引用：<strong>（方法：修改流量中数据，比如ID这种标识）</strong></li>
</ol>
<p>认证完了以后，授权应该是以会话为中心的，所以进入下一步会话管理</p>
<h5 id="第六步会话管理测试">第六步：会话管理测试</h5>
<p>主要测试 CSRF，会话固定，会话退出，会话超时等等会话相关的项目</p>
<ol>
<li><strong>检测cookie</strong>:是否带有http-only和 secure 属性</li>
<li>会话ID是否被加密</li>
<li>会话时效性</li>
</ol>
<p>这部分对固件来说个人感觉不是很重要</p>
<h5 id="第七步输入验证测试">第七步：输入验证测试</h5>
<p>之前的ping漏洞就是在这一步发现的</p>
<ol>
<li>
<p>找到web界面中可以输入的点，<strong>输入一些敏感的命令字段</strong>或者<strong>像ping的那个在外面可以正常执行的命名</strong></p>
</li>
<li>
<p>web常见漏洞的测试在这一步展开</p>
<table>
<thead>
<tr>
<th>名称</th>
</tr>
</thead>
<tbody>
<tr>
<td>SQL注入</td>
</tr>
<tr>
<td>任意命令执行</td>
</tr>
<tr>
<td>文件包含</td>
</tr>
<tr>
<td>缓冲区溢出</td>
</tr>
<tr>
<td>堆栈溢出</td>
</tr>
<tr>
<td>格式化字符串漏洞</td>
</tr>
<tr>
<td>XSS</td>
</tr>
<tr>
<td>XXE</td>
</tr>
<tr>
<td>IDAP注入</td>
</tr>
</tbody>
</table>
</li>
</ol>
<p>这一步主要是参照web测试的常见方法进行，因为固件系统一般设计的比较简陋，会存在很多这种比较常见的漏洞，具体测试方法不再展开，一般是按顺序测试一遍</p>
<h5 id="第八步错误处理测试">第八步：错误处理测试</h5>
<p>查看输入异常就会出错，一般来说报错时不能泄露敏感信息，告知客户异常即可，提示应该模糊化。但是这个模块我也不太熟悉</p>
<ol>
<li>测试应该尽量去<strong>检测服务器不同状态码返回</strong>时，是否存在信息泄漏，甚至服务器异常。</li>
<li>分析调用栈？这个调用栈的信息可以给攻击者思路。了解服务器框架，调用流程等。（还未进行了解学习）</li>
</ol>
<h5 id="第九步密码学测试">第九步：密码学测试</h5>
<p>这里主要是对WEB与服务器之间进行交互时的渠道进行测试，具体为可以测试所采用的协议是否安全，个人认为这也是一个比较重要的点。</p>
<p>（1）对于一些固件，可以逆向结合数据交互来分析其逻辑。</p>
<p>（2）对于具备以下条件的固件（首先可以拿到物理设备识别码/其次有开源定制SDK，比如是基于阿里的开源做的，这样我们可以直接下载阿里sdk进行改装，其与测试固件所用的通信协议是一样的，这样可以进行测试），可以尝试进行中间人攻击来测试设备与移动端设备+云服务器（如果有）的交互情况，从而手动测试（APP，云服务器，设备）交互时会不会有一些意外。</p>
<p>对于（2），是最近看的一篇论文《Discovering and Understanding the Security Hazards in
the Interactions between IoT Devices, Mobile Apps, and
Clouds on Smart Home Platforms  》中看到的，论文中也给出了测试的具体物理设备型号，如果满足相关要求就可以尝试以下，前置条件是了解基本的中间人攻击手法，这个不太常用。</p>
<h5 id="第十步客户界面测试">第十步：客户界面测试</h5>
<p>一些html界面也可以进行测试，一般存在以下问题：</p>
<ul>
<li>JS 执行</li>
<li>html 注入</li>
<li>url 重定向</li>
<li>css 注入</li>
<li>客户端资源控制</li>
<li>跨源资源分析测试</li>
<li>Flash 跨站测试</li>
<li>点击劫持</li>
<li>测试 WebSocket</li>
<li>测试 Web 消息</li>
<li>测试本地存储</li>
</ul>
<p>相关测试方法还是需要测试时自己看一下</p>
<h4 id="2-设备固件">2. 设备固件</h4>
<p>拿到一个固件主要关注以下三个方面：</p>
<ul>
<li>后门账户，预设密码</li>
<li>敏感功能未授权访问</li>
<li><code>web</code> 服务对各种请求的处理逻辑</li>
</ul>
<hr>
<ol>
<li>敏感数据暴露 (见 2013 年版或 2017 年版 《OWASP Top 10》 中“A6 敏感数据暴露”部分 内容)</li>
<li>是否有固件版本和最近更新日期显示</li>
<li>固件的升降级机制</li>
</ol>
<p>这个部分目前我了解的只有着重分析文件系统里面的cgi文件,下面给出web服务的整体架构以了解CGI的作用。</p>
<p><img src="../../../../static/images/cgi.jpg" alt="cgi"></p>
<p>cgi处理用户的请求并返回处理的结果。如果采用的是这种方式，那么所有的请求参数都会传递到此文件中相关功能参数中。</p>
<p>（1）对cgi文件进行源代码审计/逆向代码审计，尽量了解其逻辑，查看是否存在eval等敏感处理函数</p>
<p>（2）动态调试（参照《物联网渗透测试给出的简单例子》）</p>
<p>这里给出一个实例，每个固件对于cgi的编排存在不同，个人觉得这篇博客有一定借鉴意义：</p>
<p><a href="https://xz.aliyun.com/t/2834">https://xz.aliyun.com/t/2834</a></p>
<h4 id="3更新机制">3.更新机制</h4>
<p>很多固件会在cgi中单独命名文件的方式给出与固件升降级有关的cgi文件，可以进行审计查看，重点审查固件降级相关内容。例如此分析过程https://xz.aliyun.com/t/2834</p>
<h4 id="4-移动应用程序">4. 移动应用程序</h4>
<p>如果拿到的固件是面向家用的，比如小米的，会有配套APP，可以结合密码学测试中写的方向进行移动端测试。这个部分以后遇到相关的再总结展开。</p>
<h4 id="5较为广泛的测试">5.较为广泛的测试</h4>
<ol>
<li>漏洞匹配检查：使用使用<strong>Metasploit和Armitage</strong>工具检查类似于DUI的设备上的现有漏洞利用程序</li>
</ol>

    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>anfieldqi </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=http://anfieldqi.top/2020/%E5%9B%BA%E4%BB%B6%E6%94%BB%E5%87%BB%E9%9D%A2%E6%80%BB%E7%BB%93/>http://anfieldqi.top/2020/%E5%9B%BA%E4%BB%B6%E6%94%BB%E5%87%BB%E9%9D%A2%E6%80%BB%E7%BB%93/</span>
            </p>
            
             
            <p class="copyright-item lincese">
                除特别标注，文章采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="http://anfieldqi.top/tags/iot/">
                    #iot</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="http://anfieldqi.top">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="http://anfieldqi.top/2020/discovering_and_understanding_the_security_hazards_in_the_interactions/" class="prev" rel="prev" title="Discovering_and_understanding_the_security_hazards_in_the_interactions"><i class="iconfont icon-left"></i>&nbsp;Discovering_and_understanding_the_security_hazards_in_the_interactions</a>
         
        
        <a href="http://anfieldqi.top/2020/avatar1/" class="next" rel="next" title="Avatar1">Avatar1&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
          
<div id="gitalk-container"></div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script>
  const gitalk = new Gitalk({
    clientID: '10430486a804bdce5dd3',
    clientSecret: 'b8c2e27fc2de4a7e7f9e80094cebbf2601134eea',
    repo: 'AnfieldQi.github.io',
    owner: 'AnfieldQi',
    admin: ['AnfieldQi'],
    id: location.pathname, 
    distractionFreeMode: false 
  });
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('gitalk-container').innerHTML = 'Gitalk comments not available by default when the website is previewed locally.';
      return;
    }
    gitalk.render('gitalk-container');
  })();
</script>

    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2019 - 2020</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="http://anfieldqi.top">anfieldqi</a> | </span> 
         

         
            <a href="http://www.beian.miit.gov.cn/" target="_blank" rel="external nofollow">京ICP备20032128号 </a> |
         
		  <span>power by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> </span> 
    </div>
</footer>













    
     <link href="//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css" rel="stylesheet">  
      
     <script src="/js/vendor_gallery.min.js" async="" ></script>
    
  



     </div>
  </body>
</html>
